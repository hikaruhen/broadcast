
<!DOCTYPE html>

<html lang="zh-TW">
<head>
<link href="icon-192.png" rel="icon"/>
<link href="icon-192.png" rel="apple-touch-icon"/>
<meta charset="utf-8"/>
<title>ç­ç´šç„¡è²å»£æ’­ç³»çµ±</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
/* === ğŸ“ CSS æ’ç‰ˆèªªæ˜ ===
 * body         ï¼šæ•´é«”ç•«é¢åˆå§‹åŒ–æ¨£å¼
 * .background  ï¼šèƒŒæ™¯åœ–ç‰‡å®¹å™¨ï¼ˆå›ºå®šè¦†è“‹å…¨ç•«é¢ï¼‰
 * .time        ï¼šç•«é¢é ‚éƒ¨æ™‚é–“é¡¯ç¤º
 * .content     ï¼šä¸­é–“å…¬å‘Šè¼ªæ’­å€
 * .page        ï¼šå…¬å‘Šæ¯é ï¼ˆè¼ªæ’­åˆ‡æ›ç”¨ï¼‰
 * .marquee     ï¼šåº•éƒ¨è·‘é¦¬ç‡ˆ
 * #garbage-modeï¼šæ’­æ”¾åƒåœ¾è»Šåœ–ç‰‡èˆ‡éŸ³æ¨‚çš„è¦†è“‹å€å¡Š
 * #sound-indicatorï¼šéŸ³é‡åœ–ç¤ºï¼ˆå³ä¸‹è§’å‡ºç¾ï¼‰
*/

    body {
      margin: 0;
      padding: 0;
      font-family: "Microsoft JhengHei", sans-serif;
      overflow: hidden;
      color: #fff;
    }
    .background {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
    }
    .background img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 2s;
    }
    .background img.active {
      opacity: 1;
    }
    .time {
      font-size: 2em;
      text-align: center;
      padding: 10px;
    }
    .content {
      position: absolute;
      top: 60px;
      bottom: 80px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .page {
      display: none;
      font-size: 2em;
      text-align: center;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 20px;
      word-break: break-word;
      white-space: normal;
    }
    .page.active {
      display: block;
    }
    .marquee {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: #ff0;
      font-size: 1.5em;
      white-space: nowrap;
      overflow: hidden;
    }
    .marquee-content {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 25s linear infinite;
    }
    @keyframes scroll-left {
      from { transform: translateX(0%); }
      to { transform: translateX(-100%); }
    }

    #garbage-mode {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      z-index: 999;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    #garbage-mode img {
      max-width: 80%;
      height: auto;
    }
  
#sound-indicator { position:fixed; bottom:10px; left:10px; z-index:5000; opacity:0.5; width:40px; height:40px; display:none; }
#sound-indicator {
  position: fixed;
  bottom: 10px;
  right: 10px;
  z-index: 9999;
  opacity: 0.6;
  width: 40px;
  height: 40px;
  display: none;
  pointer-events: none;
}
</style>
</head>
<body><img class="persistent-ui" id="sound-indicator" src="sound-icon.png"/>
<!-- ğŸ”˜ æ’­æ”¾éŸ³æ•ˆé€æ˜æˆæ¬ŠæŒ‰éˆ• -->
<button id="sound-auth-btn" style="position:fixed; top:0; left:0; width:100vw; height:100vh; opacity:0; z-index:10000;">é»ä¸€ä¸‹ä»¥å•Ÿç”¨éŸ³æ•ˆ</button>
<div class="background">
<img class="active" src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be01.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be02.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be03.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be04.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be05.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be06.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be07.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be08.jpg"/>
<img src="https://raw.githubusercontent.com/hikaruhen/broadcast/main/be09.jpg"/>
</div>
<div class="time" id="clock">è¼‰å…¥ä¸­...</div>
<div class="content" id="announcement-area">
<div class="page active">ğŸ“¢ ç„¡è²å»£æ’­é¦–é </div>
</div>
<div class="marquee">
<div class="marquee-content" id="marquee-text">è¼‰å…¥ä¸­...</div>
</div>
<div id="garbage-mode">
<img alt="åƒåœ¾è»Šæé†’" src="gomidashi_woman.png"/>
<audio id="garbage-music" loop="">
<source src="prayer.mp3" type="audio/mpeg"/>
</audio>
<script>
  // æå‰æ’­æ”¾æˆæ¬Šï¼ˆéœéŸ³é æ’­ï¼‰
  window.addEventListener("load", () => {
    const music = document.getElementById("garbage-music");
    if (music) {
      music.play().then(() => {
        music.pause();
        music.currentTime = 0;
        console.log("ğŸ”Š æ’­æ”¾æˆæ¬Šå·²ç²å¾—");
      }).catch(err => console.log("âš ï¸ æ’­æ”¾æˆæ¬Šå¤±æ•—ï¼Œéœ€ä½¿ç”¨è€…äº’å‹•"));  
    }
  });
</script>
</div>
<script>// ğŸ”§ å»£æ’­ç³»çµ±ä¸»æ§åˆ¶è…³æœ¬ï¼ˆå«é¡¯ç¤ºæ™‚é–“ã€è·‘é¦¬ç‡ˆã€æ’­æ”¾æ™‚é–“æ’ç¨‹ç­‰ï¼‰

// ğŸµ æ’­æ”¾éŸ³æ¨‚æˆæ¬Šï¼šé»æ“Šç•«é¢ä¸€æ¬¡ä»¥å•Ÿç”¨éŸ³è¨Šæ’­æ”¾ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰
const music = document.getElementById("garbage-music");
const authBtn = document.getElementById("sound-auth-btn");
authBtn.addEventListener("click", () => {
  music.play().then(() => {
    music.pause();
    music.currentTime = 0;
    console.log("ğŸ”Š æ’­æ”¾æˆæ¬ŠæˆåŠŸ");
    document.getElementById('sound-indicator').style.display = 'block';
    authBtn.remove(); // ç§»é™¤é€æ˜æŒ‰éˆ•
  }).catch(err => {
    console.log("âš ï¸ æ’­æ”¾æˆæ¬Šå¤±æ•—", err);
  });
});

// ğŸ•’ é¡¯ç¤ºæ™‚é–“ï¼ˆæ¯ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
function updateClock() {
  const now = new Date();
  const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
  const formatted = now.getFullYear() + '-' +
                    String(now.getMonth() + 1).padStart(2, '0') + '-' +
                    String(now.getDate()).padStart(2, '0') + 'ï¼ˆ' +
                    days[now.getDay()] + 'ï¼‰ ' +
                    String(now.getHours()).padStart(2, '0') + ':' +
                    String(now.getMinutes()).padStart(2, '0') + ':' +
                    String(now.getSeconds()).padStart(2, '0');
  document.getElementById('clock').textContent = formatted;
}
setInterval(updateClock, 1000);
updateClock();

// ğŸ” è‡ªå‹•æ¯ 20 åˆ†é˜åˆ·æ–°é é¢ï¼ˆä½¿ç”¨ reload ä¿ç•™ sessionï¼‰
setInterval(() => {
  location.reload();
}, 20 * 60 * 1000);

// ğŸ“„ å¾ Google Sheets è®€å–å…¬å‘Šèˆ‡è·‘é¦¬ç‡ˆæ–‡å­—
fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vT4vzU7xZk5cwgUvNLxqjcDwn5ZnZ63o3XH8r5kK7oTvKQPSDjTezBWQbS-4wfyACro_-kCgJ1iNfFt/pub?output=csv')
  .then(response => response.text())
  .then(csvText => {
    const rows = csvText.trim().split('\n').map(row => row.replace(/^\ufeff/, ''));
    const lines = rows.map(row => {
      const commaIndex = row.indexOf(",");
      if (commaIndex === -1) return [row, ""];
      return [row.slice(0, commaIndex).trim(), row.slice(commaIndex + 1).trim()];
    });

    // ğŸ§¾ å…¬å‘Šé¡¯ç¤ºå€å¡Šè™•ç†
    const container = document.getElementById('announcement-area');
    container.innerHTML = '';
    let marqueeParts = [];

    lines.forEach((columns, index) => {
      const page = document.createElement('div');
      page.className = 'page';
      if (index === 0) page.classList.add('active');
      page.textContent = columns[0];
      container.appendChild(page);
      if (columns[1]) {
        marqueeParts.push(columns[1]);
      }
    });

    // ğŸï¸ è·‘é¦¬ç‡ˆæ–‡å­—
    const marquee = document.getElementById('marquee-text');
    if (marquee) {
      marquee.textContent = marqueeParts.join(' âœ¦ ') || 'ã€€';
    }

    // ğŸ“ƒ è¼ªæ’­å…¬å‘Šé é¢ï¼ˆ3 ç§’åˆ‡æ›ï¼‰
    const pages = document.querySelectorAll('.page');
    let pageIndex = 0;
    setInterval(() => {
      pages[pageIndex].classList.remove('active');
      pageIndex = (pageIndex + 1) % pages.length;
      pages[pageIndex].classList.add('active');
    }, 3000);
  });

// ğŸ–¼ï¸ èƒŒæ™¯åœ–ç‰‡è¼ªæ’­ï¼ˆæ¯ 5 ç§’åˆ‡æ›ä¸€å¼µï¼‰
const bgImgs = document.querySelectorAll('.background img');
let bgIndex = 0;
setInterval(() => {
  bgImgs[bgIndex].classList.remove('active');
  bgIndex = (bgIndex + 1) % bgImgs.length;
  bgImgs[bgIndex].classList.add('active');
}, 5000);

// ğŸ•°ï¸ ç‰¹å®šæ™‚é–“æ’­æ”¾åœ–ç‰‡èˆ‡éŸ³æ¨‚ï¼ˆæ”¯æ´å¤šæ®µï¼‰
setInterval(() => {
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();

  // ğŸ—“ï¸ æ’­æ”¾æ™‚é–“è¡¨ï¼šå¯ä¾éœ€æ±‚æ–°å¢æ›´å¤šæ®µè½
  const schedule = [
    {
      start: [12, 20], // 12:20 é–‹å§‹
      end: [12, 21],   // 12:21 çµæŸ
      image: "gomidashi_woman.png",
      audio: "prayer.mp3"
    },
    {
      start: [14, 51],
      end: [15, 5],
      image: "school_chiritori_houki.png",
      audio: "prayer.mp3"
    }
  ];

  const garbageDiv = document.getElementById("garbage-mode");
  const music = document.getElementById("garbage-music");
  const allContent = document.body.querySelectorAll("body > *:not(#garbage-mode):not(.persistent-ui)");

  let matched = null;
  for (const entry of schedule) {
    const [sh, sm] = entry.start;
    const [eh, em] = entry.end;
    const nowVal = h * 60 + m;
    const startVal = sh * 60 + sm;
    const endVal = eh * 60 + em;

    if (nowVal >= startVal && nowVal < endVal) {
      matched = entry;
      break;
    }
  }

  if (matched) {
    garbageDiv.style.display = "flex";
    allContent.forEach(el => el.style.display = "none");
    garbageDiv.querySelector("img").src = matched.image;
    if (music.src.indexOf(matched.audio) === -1) {
      music.src = matched.audio;
    }
    if (music.paused) {
      music.muted = false;
      music.play().catch(() => console.log("éŸ³æ¨‚æ’­æ”¾è¢«é˜»æ“‹"));
    }
  } else {
    garbageDiv.style.display = "none";
    allContent.forEach(el => el.style.display = "");
    if (!music.paused) {
      music.pause();
      music.currentTime = 0;
    }
  }
}, 1000);


/* ğŸ–±ï¸ ä½¿ç”¨è€…é»ä¸€ä¸‹ç•«é¢å³æå‰é€€å‡ºæ’­æ”¾ç‹€æ…‹ */
document.addEventListener("click", () => {
  const garbageDiv = document.getElementById("garbage-mode");
  const music = document.getElementById("garbage-music");
  const allContent = document.body.querySelectorAll("body > *:not(#garbage-mode):not(.persistent-ui)");

  if (garbageDiv.style.display === "flex") {
    garbageDiv.style.display = "none";
    allContent.forEach(el => el.style.display = "");
    if (!music.paused) {
      music.pause();
      music.currentTime = 0;
    }
    console.log("ğŸšª ä½¿ç”¨è€…é»æ“Šï¼Œå·²é€€å‡ºæ’­æ”¾æ¨¡å¼");
  }
});
</script>
<div id="cleaning-mode" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:998; justify-content:center; align-items:center;">
<img alt="æ¸…æƒæé†’" src="cleaning_time.png" style="max-width:80%; height:auto;"/>
</div>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log("âœ… Service worker registered"))
      .catch(err => console.log("âŒ SW registration failed:", err));
  }
</script>
</body>
</html>
